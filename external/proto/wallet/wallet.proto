syntax = "proto3";

package wallet.v1;

option go_package = "ewallet-wallet/proto/wallet/v1;walletpb";

service WalletService {

  // CREDIT
  rpc CreditBalance(CreditWalletRequest)
      returns (CreditWalletResponse);

  // DEBIT
  rpc DebitBalance(DebitWalletRequest)
      returns (DebitWalletResponse);
  // QUERY CURRENT BALANCE
  rpc GetBalance(GetWalletRequest)
      returns (GetWalletResponse);

  // QUERY TRANSACTION BY REFERENCE (AUDIT / RECONCILE)
  rpc GetWalletHistory(GetWalletTransactionRequest)
      returns (GetWalletTransactionResponse);
}

enum WalletTransactionType {
  WALLET_TRANSACTION_TYPE_UNSPECIFIED = 0;
  CREDIT = 1;
  DEBIT  = 2;
}
// ===== CREDIT =====

message CreditWalletRequest {
  int64 user_id = 1;
  double amount = 2;
  string reference = 3; // UNIQUE & IDEMPOTENT
}

message CreditWalletResponse {
  int64 wallet_id = 1;
  int64 user_id = 2;

  double balance_before = 3;
  double balance_after  = 4;

  string reference = 5;
  WalletTransactionType type = 6; // always CREDIT
}

// ===== DEBIT =====

message DebitWalletRequest {
  int64 user_id = 1;
  double amount = 2;
  string reference = 3; // UNIQUE & IDEMPOTENT
}

message DebitWalletResponse {
  int64 wallet_id = 1;
  int64 user_id = 2;

  double balance_before = 3;
  double balance_after  = 4;

  string reference = 5;
  WalletTransactionType type = 6; // always DEBIT
}

// ===== WALLET QUERY =====

message GetWalletRequest {
  int64 user_id = 1;
}

message GetWalletResponse {
  int64 wallet_id = 1;
  int64 user_id = 2;
  double balance = 3;
}

// ===== TRANSACTION QUERY =====

message GetWalletTransactionRequest {
  string reference = 1;
}

message GetWalletTransactionResponse {
  int64 wallet_id = 1;
  int64 user_id = 2;

  double amount = 3;
  WalletTransactionType type = 4;
  string reference = 5;
}